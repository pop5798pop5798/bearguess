
@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    @* <meta name="viewport" content="initial-scale=1.0 , minimum-scale=1.0 , maximum-scale=1.0" />*@
    <title>A-K選牌</title>

    <link rel="stylesheet" type="text/css" href="~/Content/akgame/css/index.css?201900910">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.33.1/sweetalert2.css" />
    <style>
        #projects img {
            max-width: 100%;
        }
    </style>
    <!--熊i猜 - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-121213657-2"></script>
    <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-121213657-2');
    </script>
</head>
<body>

    <input id="c_number" type="hidden" value="@ViewBag.p">
    <div id="projects">
        <div class="grid">
            <div class="projects">
                <div class="time_down">
                    <div id="time"></div>
                    <span id="assets"><div class="js-odoo"></div><input type="hidden" id="a" value="@ViewBag.a"></span>

                </div>
                <a href="#" onclick="exitgo()" class="exit">
                    <span>離開遊戲</span>
                    <div class="buttonmask"></div>

                </a>

                <div class="history">
                    <span>投注記錄</span>
                    <div class="buttonmask"></div>

                </div>
                <div class="bingo">
                    <span class="openhistory">
                        開牌<br>
                        記錄
                    </span>
                    <img src="">
                    <span style=" position: absolute;top: 22px;left: 47%;font-size: 14px;color: #f9ec31;">
                        上局

                    </span>

                    <div class="b_number">

                        方塊 @ViewBag.p
                    </div>

                </div>
                <div class="prompt">
                    <span>請選擇一張牌 </span>

                </div>
                <div class="description">
                    <span>
                        遊戲說明
                    </span>
                   

                </div>

                <div class="project ">
                    <input id="p_number" type="hidden" value="1">
                    <div class="mask">
                        <div class="back1"></div>
                        <div class="front"></div>
                    </div>
                </div>
                <div class="project ">
                    <input id="p_number" type="hidden" value="2">
                    <div class="mask">
                        <div class="back2"></div>
                        <div class="front"></div>
                    </div>
                </div>
                <div class="project ">
                    <input id="p_number" type="hidden" value="3">
                    <div class="mask">
                        <div class="back3"></div>
                        <div class="front"></div>
                    </div>
                </div>
                <div class="project ">
                    <input id="p_number" type="hidden" value="4">
                    <div class="mask">
                        <div class="back4"></div>
                        <div class="front"></div>
                    </div>
                </div>
                <div class="project ">
                    <input id="p_number" type="hidden" value="5">
                    <div class="mask">
                        <div class="back5"></div>
                        <div class="front"></div>
                    </div>
                </div>
                <div class="project ">
                    <input id="p_number" type="hidden" value="6">
                    <div class="mask">
                        <div class="back6"></div>
                        <div class="front"></div>
                    </div>
                </div>
                <div class="project ">
                    <input id="p_number" type="hidden" value="7">
                    <div class="mask">
                        <div class="back7"></div>
                        <div class="front"></div>
                    </div>
                </div>
                <div class="project ">
                    <input id="p_number" type="hidden" value="8">
                    <div class="mask">
                        <div class="back8"></div>
                        <div class="front"></div>
                    </div>
                </div>
                <div class="project ">
                    <input id="p_number" type="hidden" value="9">
                    <div class="mask">
                        <div class="back9"></div>
                        <div class="front"></div>
                    </div>
                </div>
                <div class="project ">
                    <input id="p_number" type="hidden" value="10">
                    <div class="mask">
                        <div class="back10"></div>
                        <div class="front"></div>
                    </div>
                </div>
                <div class="project ">
                    <input id="p_number" type="hidden" value="11">
                    <div class="mask">
                        <div class="back11"></div>
                        <div class="front"></div>
                    </div>
                </div>
                <div class="project ">
                    <input id="p_number" type="hidden" value="12">
                    <div class="mask">
                        <div class="back12"></div>
                        <div class="front"></div>
                    </div>
                </div>
                <div class="project ">
                    <input id="p_number" type="hidden" value="13">
                    <div class="mask">
                        <div class="back13"></div>
                        <div class="front"></div>
                    </div>
                </div>

                <div class="controls">
                    <span class="bottom"></span>
                    <span class="bottom"></span>
                    <span class="bottom"></span>
                    <div class="mask">

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="bg_bg"></div>
    <div class="bg_main">
        <input id="fish" type="text" value="" style="display:none;" />
        <div class="enter" style="background:url(/Content/akgame/Log/input.png) no-repeat">
            <input type="number" min="0"  step="1000" placeholder="請輸入下注額(最低1000)">
            <a href="#" id="cancel"><img src="/Content/akgame/Log/cancel.png"></a>
            <a href="#" id="confirm"><img src="/Content/akgame/Log/confirm.png"></a>
        </div>


    </div>

    <div id="load">
        <div id="pgloading">
            <div class="loadingwrap">
                <ul class="bokeh">
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="bg_main_bet">
        <div id="pgloading">
            <div class="loadingwrap">
                <ul class="bokeh">
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="main_Description">
        <img src="~/Content/akgame/AK-Description.png" style="width:100%;">
    </div>


    <script type="text/javascript" src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script src='~/Content/akgame/js/jquery.countdown.min.js' type='text/javascript'></script>
    @Scripts.Render("~/bundles/jqueryajax")
    <script src="https://cdn.bootcss.com/limonte-sweetalert2/7.33.1/sweetalert2.all.js" type="text/javascript"></script>
    <script src="https://cdn.bootcss.com/limonte-sweetalert2/7.33.1/sweetalert2.js" type="text/javascript"></script>
    <script type="text/javascript">
        function exitgo() {
            window.close();
        }

        $(function () {
            $(document).ready(function () {
                


               /* $.fn.ResponsiveBox = function (options) {
                    var a = navigator.userAgent || navigator.vendor || window.opera;
                    var level = 60;
                    if (!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4)))) {
                        if (navigator.userAgent.indexOf('Firefox') != -1 && parseFloat(navigator.userAgent.substring(navigator.userAgent.indexOf('Firefox') + 8)) >= 3.6) {//Firefox)
                            document.body.style.MozTransform = "scale(" + level / 100 + ")";
                            document.body.style.MozTransformOrigin = "center top";
                        }
                        else {
                            document.body.style.zoom = "" + level + "%";
                            document.body.style.msTransformOrigin = "center top";
                        }
                    }
                };

                $('body').ResponsiveBox();

                $(window).resize(function () {
                    //检测浏览器窗口变化
                    $('body').ResponsiveBox();
                })*/


                $(window).resize(function () {
                    calculateNewScale();
                });

                calculateNewScale(); // if the user go to the page and his window is less than 1920px

                function calculateNewScale() {
                    var percentageOn1 = $(window).width() / 1820;
                    if (percentageOn1 > 0.6) {
                        if (navigator.userAgent.indexOf('Firefox') != -1 && parseFloat(navigator.userAgent.substring(navigator.userAgent.indexOf('Firefox') + 8)) >= 3.6) //Firefox)
                        {
                            /*if (percentageOn1 < 1) {
                                percentageOn1 -= 0.3;
                            }*/

                            $(".grid").css({

                                    "-moz-transform": "scale(" + percentageOn1 + ")",
                                   "-webkit-transform": "scale(" + percentageOn1 + ")",
                                   "overflow": "hidden"
                            });


                        } else {
                            $("body").css({

                                "zoom": percentageOn1
                            });
                        }


                    } else {
                            if (navigator.userAgent.indexOf('Firefox') != -1 && parseFloat(navigator.userAgent.substring(navigator.userAgent.indexOf('Firefox') + 8)) >= 3.6) //Firefox)
                                {
                                $(".grid").css({

                                        "-moz-transform": "scale(" + 0.6 + ")",
                                    "-webkit-transform": "scale(" + 0.6 + ")",
                                    "overflow": ""

                                });

                            } else {
                                if (isMobile()) {
                                    $("body").css({

                                        "zoom": 1
                                    });

                                } else {
                                    $("body").css({

                                        "zoom": 0.6
                                    });

                                }

                                }



                    }

                }
                /*"-moz-transform": "scale(" + percentageOn1 + ")",
                    "-webkit-transform": "scale(" + percentageOn1 + ")",*/

                var bingo = $("#c_number").val();
                $("#load").hide();

                $(".bingo img").attr("src", "/Content/akgame/brand/Square" + bingo + ".png");

                if ($('.controls').hasClass('show')) {
                    $('.controls').removeClass('show');

                    subMove();
                } else {
                    $('.controls').addClass('show');

                    addMove();
                    //frontMove();
                }

                $(".exit .buttonmask").hover(function () {
                    $(".exit").addClass("hover");



                }, function () {
                    $(".exit").removeClass("hover");
                });

                $(".history .buttonmask").hover(function () {
                    $(".history").addClass("hover");



                }, function () {
                    $(".history").removeClass("hover");
                });
                var startDate = new Date();
                //var endDate = new Date('ViewBag.EndTime');


                //time(ViewBag.EndTime);
                time('@ViewBag.EndTime');
                //time('2019/03/29 19:13:05');

                $('.bg_bg,#cancel').click(function () {
                    canceal();
                });

                $('#confirm').click(function () {
                    var value = $(".enter input").val();
                    var numberRule = /^\d{4,}$/;
                    if (!value) {
                        prompt("<div style='color:red'>下注額不得為空!!</div>");
                        $(".prompt").animate({
                            left: "-=1%"
                        }, 80);
                        $(".prompt").animate({
                            left: "+=2%"
                        }, 80);
                        $(".prompt").animate({
                            left: "-=1%"
                        }, 80);

                    } else if (value.search(numberRule) == -1) {

                        prompt("<div style='color:red'>錯誤金額，請確認重新輸入!</div>");
                        $(".prompt").animate({
                            left: "-=1%"
                        }, 80);
                        $(".prompt").animate({
                            left: "+=2%"
                        }, 80);
                        $(".prompt").animate({
                            left: "-=1%"
                        }, 80);

                    } else if (parseInt($("#assets #a").val()) < parseInt(value)) {
                        prompt("<div style='color:red'>魚骨幣不足無法投注!</div>");
                        $(".prompt").animate({
                            left: "-=1%"
                        }, 80);
                        $(".prompt").animate({
                            left: "+=2%"
                        }, 80);
                        $(".prompt").animate({
                            left: "-=1%"
                        }, 80);

                    } else {
                        Bets(this);
                    }

                });
                $(".bg_main_bet #pgloading").css('opacity', '0.5');
                $("#load #pgloading").css('opacity', '0.5');
                $(".bg_main_bet").load("@Url.Action("AkBetRecord")");

                $(".history").click(function () {
                    $(".bg_main_bet").load("@Url.Action("AkBetRecord")");
                    $('.bg_bg').show();
                    $('.bg_main_bet').show();
                    prompt("投注記錄");


                });
                
                 $(".bingo").click(function () {
                    //$(".bg_main_bet").load("@Url.Action("AkBetRecord")");
                     $(".bg_main_bet").html('');
                    $(".bg_main_bet").load("@Url.Action("Akbrand")");
                    $('.bg_bg').show();
                    $('.bg_main_bet').show();
                    prompt("近期開牌記錄");


                });



                $(".description").click(function () {

                    $('.bg_bg').show();
                    $('.main_Description').show();
                    prompt("遊戲說明");


                });




            });

            function isMobile() {

                try { document.createEvent("TouchEvent"); return true; }

                catch (e) { return false; }

            }


            function assets() {
                $("#assets").load("@Url.Action("AkAssets")");

            }

            function prompt(t) {

                $('.prompt span').html(t);

            }


            function canceal() {
                $('.bg_bg').hide();
                $('.bg_main').hide();
                $('.bg_main_bet').hide();
                $('.main_Description').hide();
                prompt("請選擇一張牌");
                $('.enter input').val(null);


            }


            function Bets(brand) {

                Swal.fire({
                    title: '確認資訊',
                    html: '選擇的牌：方塊' + $(".bg_main #fish").val() + '<br>' +
                        '投注額：' + $(".enter input").val() + '魚骨幣<br>' +
                        '賠率：12',
                    type: 'info',
                    confirmButtonText: '確定下注!',
                    showCancelButton: true
                }).then((result) => {
                    if (result.value) {
                        $("#load").show();
                        $.ajax({
                                type: "POST",
                                url: '@Url.Action("AKBets", "Html5")',
                                data: { money: $(".enter input").val(), Number: $(".bg_main #fish").val() },
                            success: function (data) {
                                    assets();
                                    $(".bg_main_bet").load("@Url.Action("AkBetRecord")");
                                    if (data == 1) {

                                        Swal.fire({
                                            position: 'top-end',
                                            type: 'success',
                                            title: '下注成功',
                                            showConfirmButton: false,
                                            timer: 1500
                                        });

                                        $("#load").hide();
                                    } else {
                                        Swal.fire({
                                            title: '下注失敗!',
                                            text: '請重新操作',
                                            type: 'error',
                                            confirmButtonText: '確定!'

                                        });


                                    }


                                }

                    });
                    canceal();
                    }


                });


            }



            function time(t) {
                console.log(t);
                $("#time").countdown(t).on('update.countdown', function (event) {
                        $(this).html(
                            event.strftime('%M:%S')
                    );
                }).on('finish.countdown', function (event) {
                    var m = 0;
                    $(this).html("派彩");
                    $('.prompt span').html("正在派彩中");
                    if ($(this).text() == "派彩" && m != 1) {
                        $('.bg_bg').hide();
                        $('.bg_main').hide();
                        $(".controls").removeClass('show');
                        $('.start').html('<span>开</span><span>始</span>');
                        subMove();
                        m = 1;
                    }

                    if (m == 1) {
                        $.ajax({
                        type: "Get",
                        url: "@Url.Action("AKGameData", "Html5")",
                        dataType: "json",
                        success: function (msg) {
                             $(".bg_main_bet").load("@Url.Action("AkBetRecord")");

                            var d = new Date(msg.h5game.endTime.match(/\d+/)[0] * 1);
                            //var d = new Date(dateObject);
                            var day = d.getDate();
                            var month = d.getMonth() + 1;
                            var year = d.getFullYear();
                            var curr_hour = d.getHours();
                            var curr_min = d.getMinutes();
                            var curr_sec = d.getSeconds();
                            if (day < 10) {
                                day = "0" + day;
                            }
                            if (month < 10) {
                                month = "0" + month;
                            }
                            var date = year + "/" + month + "/" + day + " " + curr_hour + ":" + curr_min + ":" + curr_sec;
                            time(date);

                            $(".bingo img").attr("src", "/Content/akgame/brand/Square" + msg.Brand + ".png");
                            $(".b_number").html("方塊 " + msg.Brand);
                            if ($("#time").text() != "派彩" && m == 1) {
                                $(".controls").addClass('show');
                                $('.start').html('<span>重</span><span>置</span>');
                                addMove();
                                m = 0;
                                //$('.prompt span').html("請選擇一張牌");
                                prompt("請選擇一張牌");


                            }


                        }, error: function () {
                            console.log("派彩");
                        }

                        });
                    }


                });

            }





            $('.controls').click(function () {
                if ($(this).hasClass('show')) {
                    $(this).removeClass('show');

                    subMove();
                } else {
                    $(this).addClass('show');

                    addMove();
                }
            });

            $('.project').click(function () {
                if ($(this).hasClass('showli')) {
                    var num = $(this).find("#p_number").val();
                    $('.bg_main #fish').val(num);
                    $('.bg_bg').show();
                    $('.bg_main').show();
                    $('.prompt span').html("你選擇了方塊"+num);
                   // Bets(this);
                } else {
                    num = $(this).find("#p_number");
                    $('.bg_main #fish').val(num);
                    $('.bg_bg').show();
                    $('.bg_main').show();
                }
            });


        })

        function addMove() {
            $('.project').each(function (index, item) {
                setTimeout(function () {
                    $(item).addClass('ani' + index);
                    $('.ani' + index).addClass('showli');
                    $('.bg_bg').hide();
                    $('.bg_main').hide();
                    $('.bg_main_bet').hide();
                    $('.main_Description').hide();
                }, index * 300);
            });
        }
        function frontMove() {
            $('.project').each(function (index, item) {
                setTimeout(function () {
                    //var id = $(item).parent().parent().find('input').val();
                    //alert(id);
                    $('.ani' + index).addClass('showli');
                    $('.bg_bg').hide();
                    $('.bg_main').hide();
                    $('.bg_main_bet').hide();
                    $('.main_Description').hide();
                }, index * 300);
            })
        }

        function subMove() {
            $('.project').each(function (index, item) {
                $('.project').removeClass('showli');
                $(item).removeClass('ani' + index);
            })
        }
    </script>
    <script src="~/Content/akgame/js/odoo.js"></script>
    <script>
        odoo.default({ el: '.js-odoo', value: '@ViewBag.Assets' });
    </script>
</body>
</html>